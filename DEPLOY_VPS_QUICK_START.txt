╔══════════════════════════════════════════════════════════════════════╗
║              DEPLOY VPS - QUICK START GUIDE                          ║
║                  Full Stack Deployment                               ║
╚══════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────┐
│  BƯỚC 1: SSH VÀO VPS                                                │
└──────────────────────────────────────────────────────────────────────┘

ssh user@222.252.23.248


┌──────────────────────────────────────────────────────────────────────┐
│  BƯỚC 2: CLONE/PULL CODE                                            │
└──────────────────────────────────────────────────────────────────────┘

# Lần đầu:
mkdir -p ~/apps/thuvienanh
cd ~/apps/thuvienanh
git clone https://github.com/hksdtp/thuvienanh.git .

# Lần sau:
cd ~/apps/thuvienanh
git pull origin main


┌──────────────────────────────────────────────────────────────────────┐
│  BƯỚC 3: TẠO FILE .env                                              │
└──────────────────────────────────────────────────────────────────────┘

nano .env

# Paste nội dung sau:

NODE_ENV=production
PORT=3000

DATABASE_URL=postgresql://postgres:Demo1234@222.252.23.248:5499/Ninh96
POSTGRES_HOST=222.252.23.248
POSTGRES_PORT=5499
POSTGRES_USER=postgres
POSTGRES_PASSWORD=Demo1234
POSTGRES_DB=Ninh96

SYNOLOGY_HOST=222.252.23.248
SYNOLOGY_PORT=6868
SYNOLOGY_USERNAME=your_username
SYNOLOGY_PASSWORD=your_password

SMB_HOST=222.252.23.248
SMB_PORT=445
SMB_USERNAME=your_username
SMB_PASSWORD=your_password
SMB_SHARE=marketing

ALLOWED_ORIGIN=*
NEXT_PUBLIC_API_URL=http://222.252.23.248:3000

# Save: Ctrl+O, Enter, Ctrl+X


┌──────────────────────────────────────────────────────────────────────┐
│  BƯỚC 4: CHẠY SCRIPT DEPLOY TỰ ĐỘNG                                │
└──────────────────────────────────────────────────────────────────────┘

bash scripts/deploy-vps.sh

# Script sẽ tự động:
# ✓ Install dependencies
# ✓ Build production
# ✓ Stop old processes
# ✓ Start new process
# ✓ Save PM2 config
# ✓ Test health


┌──────────────────────────────────────────────────────────────────────┐
│  HOẶC: DEPLOY THỦ CÔNG                                              │
└──────────────────────────────────────────────────────────────────────┘

# Install
npm install

# Build
npm run build

# Stop old
pm2 stop thuvienanh 2>/dev/null || true
pm2 delete thuvienanh 2>/dev/null || true

# Start new
pm2 start npm --name "thuvienanh" -- start

# Save
pm2 save


┌──────────────────────────────────────────────────────────────────────┐
│  KIỂM TRA                                                            │
└──────────────────────────────────────────────────────────────────────┘

# Status
pm2 status

# Logs
pm2 logs thuvienanh

# Test
curl http://localhost:3000
curl http://localhost:3000/api/health

# Browser
http://222.252.23.248:3000


┌──────────────────────────────────────────────────────────────────────┐
│  MONITORING                                                          │
└──────────────────────────────────────────────────────────────────────┘

# Real-time monitoring
pm2 monit

# Logs (follow)
pm2 logs thuvienanh

# Logs (last 50 lines)
pm2 logs thuvienanh --lines 50

# Restart
pm2 restart thuvienanh

# Stop
pm2 stop thuvienanh


┌──────────────────────────────────────────────────────────────────────┐
│  UPDATE CODE SAU NÀY                                                │
└──────────────────────────────────────────────────────────────────────┘

cd ~/apps/thuvienanh
git pull origin main
bash scripts/deploy-vps.sh


┌──────────────────────────────────────────────────────────────────────┐
│  SETUP PM2 AUTO-START (LẦN ĐẦU)                                    │
└──────────────────────────────────────────────────────────────────────┘

# Generate startup script
pm2 startup

# Copy và chạy command được suggest (ví dụ):
# sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u user --hp /home/user

# Save processes
pm2 save


┌──────────────────────────────────────────────────────────────────────┐
│  TROUBLESHOOTING                                                     │
└──────────────────────────────────────────────────────────────────────┘

# Port 3000 bị chiếm:
lsof -i :3000
kill -9 <PID>

# Database không connect được:
psql -h 222.252.23.248 -p 5499 -U postgres -d Ninh96

# Clear cache:
rm -rf node_modules .next
npm install
npm run build

# Check logs:
pm2 logs thuvienanh --lines 100


┌──────────────────────────────────────────────────────────────────────┐
│  OPTIONAL: SETUP NGINX                                              │
└──────────────────────────────────────────────────────────────────────┘

# Tạo config
sudo nano /etc/nginx/sites-available/thuvienanh

# Paste config (xem DEPLOY_VPS_FULL_STACK.md)

# Enable
sudo ln -s /etc/nginx/sites-available/thuvienanh /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# Access qua port 80
http://222.252.23.248


┌──────────────────────────────────────────────────────────────────────┐
│  URLS                                                                │
└──────────────────────────────────────────────────────────────────────┘

Frontend:  http://222.252.23.248:3000
API:       http://222.252.23.248:3000/api/*
Health:    http://222.252.23.248:3000/api/health


┌──────────────────────────────────────────────────────────────────────┐
│  FILES                                                               │
└──────────────────────────────────────────────────────────────────────┘

Full Guide:     DEPLOY_VPS_FULL_STACK.md
Deploy Script:  scripts/deploy-vps.sh
This Guide:     DEPLOY_VPS_QUICK_START.txt


═══════════════════════════════════════════════════════════════════════

                    THAT'S IT! SIMPLE & FAST! 🚀

═══════════════════════════════════════════════════════════════════════

